<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RHAT Test - Task Page</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 8px;
      }
      .task-content {
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        margin: 20px 0;
      }
      .task-header {
        background: #e9ecef;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      .task-body {
        background: white;
        padding: 20px;
        border-radius: 5px;
        border: 1px solid #dee2e6;
      }
      .status {
        padding: 15px;
        margin: 20px 0;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
      }
      .status.active {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .status.completed {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        border-left: 4px solid #007bff;
      }
      .test-controls {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .test-controls button {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
      }
      .test-controls button:hover {
        background: #0056b3;
      }
      .test-controls button.danger {
        background: #dc3545;
      }
      .test-controls button.danger:hover {
        background: #c82333;
      }
      .test-controls button.success {
        background: #28a745;
      }
      .test-controls button.success:hover {
        background: #218838;
      }
      .extension-info {
        background: #fff3cd;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        border-left: 4px solid #ffc107;
      }
      .timer {
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        margin: 20px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
      }
      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
        width: 0%;
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìã RHAT Test - Task Page</h1>
        <p>Simulating RaterHub Task Environment</p>
      </div>

      <div class="info">
        <strong>Test Task Page:</strong><br />
        This page simulates a RaterHub task page. The extension should detect
        this as a task page and handle it accordingly.<br />
        Use the controls below to test different scenarios and extension
        responses.
      </div>

      <div id="status" class="status active">
        üîÑ Task page loaded - Extension should detect this
      </div>

      <div class="task-content">
        <div class="task-header">
          <h3>Test Task #12345</h3>
          <p>
            <strong>Type:</strong> Rating Task | <strong>Priority:</strong> High
            | <strong>Deadline:</strong> 2 hours
          </p>
        </div>

        <div class="task-body">
          <h4>Task Instructions</h4>
          <p>
            This is a simulated task page for testing the RHAT extension's task
            detection and handling capabilities.
          </p>

          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>

          <div class="timer" id="timer">
            ‚è±Ô∏è Task Timer: <span id="timeRemaining">10:00</span>
          </div>

          <p>
            <em
              >The extension should have detected this page and triggered the
              appropriate workflow (alarm, notifications, etc.)</em
            >
          </p>
        </div>
      </div>

      <div class="test-controls">
        <strong>Test Controls:</strong><br />
        <button onclick="simulateCompletion()">Simulate Task Completion</button>
        <button onclick="simulateError()">Simulate Error (403)</button>
        <button onclick="resetTask()">Reset Task</button>
        <button onclick="goBack()">Back to Main Page</button>
      </div>

      <div class="extension-info">
        <strong>Extension Detection:</strong><br />
        The extension should automatically detect this page as a task page
        (/task/show URL pattern).<br />
        Check the browser console and extension popup for detection logs and
        notifications.
      </div>

      <div class="info">
        <strong>Testing Checklist:</strong>
        <ul>
          <li>‚úÖ Extension detects task page on load</li>
          <li>‚úÖ Alarm/notification triggers (if enabled)</li>
          <li>‚úÖ Error detection works (403 simulation)</li>
          <li>‚úÖ Task completion handling</li>
          <li>‚úÖ Navigation back to main page</li>
        </ul>
      </div>
    </div>

    <script>
      let taskTimer = 600; // 10 minutes in seconds
      let timerInterval;
      let taskCompleted = false;

      function initializeTaskPage() {
        console.log("RHAT Test: Task page initialized");
        startTimer();
        updateStatus(
          "active",
          "üîÑ Task page loaded - Extension should detect this"
        );

        // Check for pending alarm from navigation
        if (typeof checkForPendingAlarm === "function") {
          console.log("RHAT Test: Calling checkForPendingAlarm");
          checkForPendingAlarm();
        } else {
          console.log("RHAT Test: checkForPendingAlarm function not available");
        }

        // Simulate extension detection
        setTimeout(() => {
          console.log("RHAT Test: Simulating extension task detection");
          updateStatus(
            "active",
            "üéØ Extension detected task page - Workflow triggered"
          );
        }, 1000);
      }

      function startTimer() {
        timerInterval = setInterval(() => {
          taskTimer--;
          updateTimerDisplay();

          if (taskTimer <= 0 && !taskCompleted) {
            simulateCompletion();
          }
        }, 1000);
      }

      function updateTimerDisplay() {
        const minutes = Math.floor(taskTimer / 60);
        const seconds = taskTimer % 60;
        document.getElementById("timeRemaining").textContent = `${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

        // Update progress bar
        const progressPercent = ((600 - taskTimer) / 600) * 100;
        document.getElementById("progressFill").style.width = `${Math.min(
          progressPercent,
          100
        )}%`;
      }

      function updateStatus(type, message) {
        const statusElement = document.getElementById("status");
        statusElement.className = `status ${type}`;
        statusElement.innerHTML = message;
      }

      function simulateCompletion() {
        taskCompleted = true;
        clearInterval(timerInterval);
        updateStatus("completed", "‚úÖ Task completed successfully!");
        document.getElementById("progressFill").style.width = "100%";
        document.getElementById("progressFill").style.background =
          "linear-gradient(90deg, #28a745 0%, #20c997 100%)";
        console.log("RHAT Test: Task completion simulated");
      }

      function simulateError() {
        clearInterval(timerInterval);
        updateStatus(
          "error",
          "‚ùå Error 403 Forbidden - Task submitted or expired"
        );
        document.getElementById("progressFill").style.background =
          "linear-gradient(90deg, #dc3545 0%, #c82333 100%)";
        document.getElementById("progressFill").style.width = "100%";

        // Simulate redirect to main page after error
        setTimeout(() => {
          updateStatus("error", "üîÑ Redirecting to main page...");
          setTimeout(() => {
            goBack();
          }, 2000);
        }, 3000);

        console.log("RHAT Test: 403 error simulated");
      }

      function resetTask() {
        taskCompleted = false;
        taskTimer = 600;
        clearInterval(timerInterval);
        startTimer();
        updateStatus("active", "üîÑ Task reset - Starting over");
        document.getElementById("progressFill").style.width = "0%";
        document.getElementById("progressFill").style.background =
          "linear-gradient(90deg, #28a745 0%, #20c997 100%)";
        console.log("RHAT Test: Task reset");
      }

      function goBack() {
        console.log("RHAT Test: Navigating back to main page");
        window.location.href = "test-main.html";
      }

      // Initialize when page loads
      window.addEventListener("load", initializeTaskPage);

      // Log page load
      console.log("RHAT Test: Task page loaded");
    </script>
  </body>
</html>
