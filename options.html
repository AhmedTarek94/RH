<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RHAT - Settings</title>
    <link rel="stylesheet" href="styles_new (1).css" />
    <link rel="stylesheet" href="styles_new (2).css" />
    <style>
      /* Additional styles for footer elements not covered in new stylesheets */
      .setting-group {
        margin-bottom: 16px;
      }

      .setting-group h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
      }

      .setting-item {
        margin-bottom: 12px;
      }

      .toggle-label {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        font-size: 14px;
        color: var(--text-secondary);
      }

      .toggle-slider {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
        background-color: var(--gray-300);
        border-radius: 24px;
        transition: 0.3s;
        cursor: pointer;
      }

      .toggle-slider:before {
        content: "";
        position: absolute;
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: var(--white);
        border-radius: 50%;
        transition: 0.3s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      }

      input[type="checkbox"]:checked + .toggle-slider {
        background-color: var(--primary-color);
      }

      input[type="checkbox"]:checked + .toggle-slider:before {
        transform: translateX(20px);
      }

      .reset-btn {
        background: var(--danger-color);
        color: var(--white);
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.3s ease;
      }

      .reset-btn:hover {
        background: var(--danger-color);
        filter: brightness(0.9);
      }

      /* Dark theme adjustments for footer elements */
      [data-theme="dark"] .toggle-label {
        color: var(--text-secondary);
      }

      [data-theme="dark"] .toggle-slider {
        background-color: var(--gray-600);
      }

      [data-theme="dark"] input[type="checkbox"]:checked + .toggle-slider {
        background-color: var(--primary-color);
      }
    </style>
  </head>
  <body class="options">
    <div class="options-container">
      <header class="options-header">
        <div class="header-content">
          <h1 class="options-title">RHAT</h1>
          <p class="options-subtitle">
            RaterHub Automated Tasks - Configure your monitoring preferences
          </p>
        </div>
      </header>

      <main class="options-main">
        <!-- Tab Navigation -->
        <div class="tabs-container">
          <div class="tabs">
            <button class="tab-btn active" data-tab="main-settings">
              <span class="tab-icon">‚öôÔ∏è</span>
              Main Settings
            </button>
            <button class="tab-btn" data-tab="notifications">
              <span class="tab-icon">üîî</span>
              Notifications
            </button>
          </div>
        </div>

        <!-- Main Settings Tab -->
        <div id="main-settings" class="tab-content active">
          <section class="settings-section">
            <div class="section-header">
              <h2 class="section-title">General Settings</h2>
              <p class="section-description">
                Control when and how the monitor operates
              </p>
            </div>

            <div class="settings-grid">
              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Monitor Status</h3>
                  <label class="toggle-switch large">
                    <input type="checkbox" id="enabledToggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <!-- Removed description for compactness -->
                <div class="status-indicator">
                  <div class="status-dot" id="statusDot"></div>
                  <span id="statusText">Disabled</span>
                </div>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Dark mode</h3>
                  <label class="toggle-switch">
                    <input type="checkbox" id="themeToggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <!-- Removed description for compactness -->
                <div class="status-indicator">
                  <div class="status-dot" id="themeStatusDot"></div>
                  <span id="themeStatusText">Light Mode</span>
                </div>
              </div>

              <div
                class="setting-card"
                style="width: fit-content; min-width: 200px"
              >
                <div
                  class="setting-header"
                  style="
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                    padding: 12px 16px;
                  "
                >
                  <h3
                    class="setting-title"
                    style="margin: 0; align-self: flex-start"
                  >
                    Operation Mode
                  </h3>
                  <div
                    class="mode-selector"
                    style="
                      display: flex;
                      gap: 16px;
                      margin: 0;
                      align-self: flex-start;
                    "
                  >
                    <label
                      class="radio-option"
                      style="
                        display: flex;
                        align-items: center;
                        gap: 4px;
                        margin: 0;
                        font-size: 13px;
                      "
                    >
                      <input
                        type="radio"
                        name="mode"
                        value="alarm_only"
                        id="alarmOnlyMode"
                      />
                      <span class="radio-custom"></span>
                      <div class="radio-content" style="margin: 0">
                        <strong>Alarm only</strong>
                      </div>
                    </label>
                    <label
                      class="radio-option"
                      style="
                        display: flex;
                        align-items: center;
                        gap: 4px;
                        margin: 0;
                        font-size: 13px;
                      "
                    >
                      <input
                        type="radio"
                        name="mode"
                        value="alarm_and_click"
                        id="alarmAndClickMode"
                      />
                      <span class="radio-custom"></span>
                      <div class="radio-content" style="margin: 0">
                        <strong>Alarm & acquire</strong>
                      </div>
                    </label>
                  </div>
                </div>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Refresh Interval</h3>
                  <div class="interval-selector">
                    <div class="interval-options">
                      <button class="interval-btn" data-value="0.5">
                        0.5s
                      </button>
                      <button class="interval-btn active" data-value="1">
                        1s
                      </button>
                      <button class="interval-btn" data-value="2">2s</button>
                      <button class="interval-btn" data-value="5">5s</button>
                      <button class="interval-btn" data-value="10">10s</button>
                      <button class="interval-btn" data-value="30">30s</button>
                      <button class="interval-btn" data-value="60">60s</button>
                    </div>
                    <p class="interval-display">
                      Currently refreshing every
                      <span id="currentInterval">1</span> second(s)
                    </p>
                  </div>
                </div>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Alert Sound</h3>
                </div>
                <div class="setting-content">
                  <div class="setting-item">
                    <label for="soundSourceSelect">Sound Source:</label>
                    <select id="soundSourceSelect" class="styled-select">
                      <option value="default" selected>Default</option>
                      <option value="file">Local file</option>
                      <option value="url">Online audio link</option>
                    </select>
                  </div>

                  <div id="soundSourceControls">
                    <div
                      id="fileInputContainer"
                      class="file-input-container"
                      style="display: none"
                    >
                      <label for="alertSoundFile" class="file-input-label"
                        >Choose MP3 file:</label
                      >
                      <div class="file-input-wrapper">
                        <input
                          type="file"
                          id="alertSoundFile"
                          accept="audio/mp3,audio/mpeg"
                          class="file-input"
                        />
                        <span
                          id="selectedFileName"
                          class="selected-file-name"
                          style="
                            display: none;
                            margin-left: 10px;
                            font-size: 12px;
                            color: var(--text-secondary);
                          "
                        ></span>
                      </div>
                    </div>

                    <div
                      id="urlInputContainer"
                      class="url-input-container"
                      style="display: none"
                    >
                      <label for="alertSoundUrl" class="url-input-label"
                        >MP3 URL:</label
                      >
                      <input
                        type="text"
                        id="alertSoundUrl"
                        class="styled-select url-input"
                        placeholder="Paste direct MP3 URL here (must end with .mp3)"
                        pattern=".*\.mp3$"
                      />
                    </div>
                  </div>

                  <div class="spacer-md"></div>
                  <div class="sound-controls">
                    <button
                      id="playPauseSoundBtn"
                      class="btn btn-secondary"
                      title="Play/Pause"
                    >
                      <span id="playPauseIcon" class="sound-icon">&#9654;</span>
                    </button>
                    <button
                      id="stopSoundBtn"
                      class="btn btn-outline"
                      title="Stop"
                    >
                      <span class="sound-icon">&#9632;</span>
                    </button>
                  </div>

                  <div
                    id="soundErrorMsg"
                    class="error-message"
                    style="display: none"
                  ></div>
                </div>
              </div>
            </div>
          </section>

          <section class="settings-section">
            <div class="section-header">
              <h2 class="section-title">Notification Settings</h2>
              <p class="section-description">
                Configure how you want to be notified about tasks
              </p>
            </div>

            <div class="settings-grid">
              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Desktop Notifications</h3>
                  <label class="toggle-switch">
                    <input type="checkbox" id="desktopNotificationsToggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <p class="setting-description">
                  Show browser notifications when tasks become available or
                  incomplete tasks are detected
                </p>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Mouse Movement Detection</h3>
                  <label class="toggle-switch">
                    <input type="checkbox" id="mouseMovementToggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <p class="setting-description">
                  Automatically stop alarm sounds when mouse movement is
                  detected
                </p>
              </div>
            </div>
          </section>

          <section class="settings-section">
            <div class="section-header">
              <h2 class="section-title">Advanced Features</h2>
              <p class="section-description">
                Configure advanced monitoring and error handling features
              </p>
            </div>

            <div class="settings-grid">
              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Incomplete Tasks Handling</h3>
                  <label class="toggle-switch">
                    <input type="checkbox" id="incompleteTasksToggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <p class="setting-description">
                  Detect and handle incomplete tasks with popup notifications
                </p>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Enhanced Error Detection</h3>
                  <label class="toggle-switch">
                    <input type="checkbox" id="errorDetectionToggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <p class="setting-description">
                  Automatically detect and handle 403 errors and other issues
                </p>
              </div>
            </div>
          </section>
        </div>

        <!-- Notifications Tab -->
        <div id="notifications" class="tab-content">
          <section class="settings-section">
            <div class="section-header">
              <h2 class="section-title">Gmail Notifications</h2>
              <p class="section-description">
                Configure email notifications for task detection events
              </p>
            </div>

            <div class="settings-grid">
              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Enable Gmail Notifications</h3>
                  <label class="toggle-switch">
                    <input type="checkbox" id="gmailNotificationsToggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <p class="setting-description">
                  Send email notifications when tasks become available
                </p>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Notification Email</h3>
                  <form id="notificationEmailForm" novalidate>
                    <div class="input-group">
                      <input
                        type="email"
                        id="notificationEmailInput"
                        class="styled-input"
                        placeholder="your.email@example.com"
                        pattern="^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}$"
                        required
                      />
                      <button
                        type="submit"
                        class="btn btn-primary"
                        id="saveEmailBtn"
                      >
                        Save
                      </button>
                    </div>
                    <div
                      id="emailErrorMsg"
                      class="error-message"
                      style="display: none"
                    >
                      Please enter a valid email address.
                    </div>
                  </form>
                </div>
                <p class="setting-description">
                  Email address where notifications will be sent
                </p>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Gmail Authentication</h3>
                  <div class="auth-status-container">
                    <div class="status-indicator">
                      <div class="status-dot" id="gmailAuthStatusDot"></div>
                      <span id="gmailAuthStatusText">Not Authenticated</span>
                    </div>
                    <button id="gmailAuthBtn" class="btn btn-primary">
                      Authenticate
                    </button>
                  </div>
                </div>
                <p class="setting-description">
                  Connect your Gmail account to send notifications
                </p>
              </div>

              <div class="setting-card">
                <div class="setting-header">
                  <h3 class="setting-title">Test Email</h3>
                  <button id="testEmailBtn" class="btn btn-secondary">
                    Send Test Email
                  </button>
                </div>
                <p class="setting-description">
                  Send a test email to verify your Gmail setup
                </p>
                <div
                  id="testEmailStatus"
                  class="status-message"
                  style="display: none"
                ></div>
              </div>
            </div>
          </section>

          <section class="settings-section">
            <div class="section-header">
              <h2 class="section-title">Notification History</h2>
              <p class="section-description">
                View recent email notifications and their status
              </p>
            </div>

            <div class="settings-grid">
              <div class="setting-card full-width">
                <div class="setting-header">
                  <h3 class="setting-title">Recent Notifications</h3>
                  <button id="refreshHistoryBtn" class="btn btn-outline">
                    Refresh
                  </button>
                </div>
                <div id="notificationHistory" class="notification-history">
                  <div class="history-item">
                    <div class="history-content">
                      <div class="history-title">No notifications sent yet</div>
                      <div class="history-meta">
                        Configure Gmail notifications to see history
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <section class="info-section">
          <div class="info-card">
            <h3 class="info-title">üöÄ How it works</h3>
            <ol class="info-list">
              <li>
                Navigate to
                <code>https://www.raterhub.com/evaluation/rater</code>
              </li>
              <li>Enable the monitor using the toggle above</li>
              <li>
                The extension will automatically refresh the page at your chosen
                interval
              </li>
              <li>When tasks become available, you'll hear an alarm sound</li>
              <li>
                If "Auto Click" mode is enabled, the extension will
                automatically acquire tasks
              </li>
            </ol>
          </div>

          <div class="info-card">
            <h3 class="info-title">‚ö†Ô∏è Important Notes</h3>
            <ul class="info-list">
              <li>
                Keep the RaterHub tab open and visible for best performance
              </li>
              <li>Lower refresh intervals may consume more resources</li>
              <li>
                The extension only works on the official RaterHub evaluation
                page
              </li>
              <li>Make sure your browser allows sound notifications</li>
            </ul>
          </div>
        </section>
      </main>

      <footer class="options-footer">
        <div class="footer-content">
          <div class="setting-group">
            <h3>Test Button</h3>
            <div class="setting-item">
              <label class="toggle-label">
                <input type="checkbox" id="showTestButton" />
                <span class="toggle-slider"></span>
                Show test button on main page
              </label>
              <p class="setting-description">
                Enable to show a test button that simulates finding an acquire
                button for testing purposes.
              </p>
            </div>
          </div>

          <div class="setting-group">
            <h3>Reset to Defaults</h3>
            <button id="resetBtn" class="reset-btn">Reset All Settings</button>
          </div>

          <div class="save-status">
            <span id="saveStatus" class="save-message"
              >Settings saved automatically</span
            >
          </div>
        </div>
      </footer>
    </div>

    <script src="options.js"></script>
  </body>
</html>
