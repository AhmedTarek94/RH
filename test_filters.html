<!DOCTYPE html>
<html>
<head>
    <title>Filter Functionality Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        button { margin: 5px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Filter Functionality Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Filter Settings Storage</h2>
        <button onclick="testFilterStorage()">Test Filter Storage</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Preset Functionality</h2>
        <button onclick="testPresetFunctionality()">Test Preset System</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Real-time Sync</h2>
        <button onclick="testRealTimeSync()">Test Real-time Sync</button>
        <div id="test3-result"></div>
    </div>

    <script>
        function testFilterStorage() {
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = 'Testing filter storage...';
            
            // Test basic filter settings
            const testSettings = {
                taskTypeFilter: ['search', 'evaluation'],
                minDuration: 5,
                maxDuration: 30,
                timeRangeEnabled: true,
                timeRangeStart: '09:00',
                timeRangeEnd: '17:00',
                daysOfWeekFilter: ['mon', 'wed', 'fri'],
                minReward: 0.10
            };
            
            chrome.storage.sync.set(testSettings, () => {
                chrome.storage.sync.get(Object.keys(testSettings), (data) => {
                    let success = true;
                    let errors = [];
                    
                    for (const [key, value] of Object.entries(testSettings)) {
                        if (JSON.stringify(data[key]) !== JSON.stringify(value)) {
                            success = false;
                            errors.push(`${key}: expected ${JSON.stringify(value)}, got ${JSON.stringify(data[key])}`);
                        }
                    }
                    
                    if (success) {
                        resultDiv.innerHTML = '<span class="success">✓ Filter storage test PASSED</span>';
                    } else {
                        resultDiv.innerHTML = `<span class="error">✗ Filter storage test FAILED</span><br>${errors.join('<br>')}`;
                    }
                });
            });
        }

        function testPresetFunctionality() {
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = 'Testing preset functionality...';
            
            const presetName = 'test_preset';
            const presetData = {
                taskTypeFilter: ['search'],
                minDuration: 10,
                maxDuration: 45,
                timeRangeEnabled: false,
                timeRangeStart: '08:00',
                timeRangeEnd: '18:00',
                daysOfWeekFilter: ['tue', 'thu'],
                minReward: 0.15
            };
            
            // Save preset
            chrome.storage.sync.get(['filterPresets'], (data) => {
                const presets = data.filterPresets || {};
                presets[presetName] = presetData;
                
                chrome.storage.sync.set({ filterPresets: presets }, () => {
                    // Load preset
                    chrome.storage.sync.get(['filterPresets'], (newData) => {
                        if (newData.filterPresets && newData.filterPresets[presetName]) {
                            const savedPreset = newData.filterPresets[presetName];
                            let success = true;
                            let errors = [];
                            
                            for (const [key, value] of Object.entries(presetData)) {
                                if (JSON.stringify(savedPreset[key]) !== JSON.stringify(value)) {
                                    success = false;
                                    errors.push(`${key}: expected ${JSON.stringify(value)}, got ${JSON.stringify(savedPreset[key])}`);
                                }
                            }
                            
                            if (success) {
                                resultDiv.innerHTML = '<span class="success">✓ Preset functionality test PASSED</span>';
                            } else {
                                resultDiv.innerHTML = `<span class="error">✗ Preset functionality test FAILED</span><br>${errors.join('<br>')}`;
                            }
                        } else {
                            resultDiv.innerHTML = '<span class="error">✗ Preset not found in storage</span>';
                        }
                    });
                });
            });
        }

        function testRealTimeSync() {
            const resultDiv = document.getElementById('test3-result');
            resultDiv.innerHTML = 'Testing real-time sync...';
            
            // This would normally test message passing between components
            // For now, we'll just verify the settings update mechanism works
            const testSetting = { minDuration: 8 };
            
            chrome.storage.sync.set(testSetting, () => {
                chrome.storage.sync.get(['minDuration'], (data) => {
                    if (data.minDuration === testSetting.minDuration) {
                        resultDiv.innerHTML = '<span class="success">✓ Real-time sync test PASSED (basic functionality)</span>';
                    } else {
                        resultDiv.innerHTML = `<span class="error">✗ Real-time sync test FAILED</span>`;
                    }
                });
            });
        }
    </script>
</body>
</html>
