/*

 BSD 3-Clause License

 Copyright (c) 2012-2017, katspaugh and contributors
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 * Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

 * Neither the name of the copyright holder nor the names of its
   contributors may be used to endorse or promote products derived from
   this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_ES6=!1;$jscomp.ASSUME_ES2020=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.INSTRUMENT_ASYNC_CONTEXT=!0;$jscomp.defineProperty=$jscomp.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.ASSUME_ES2020?globalThis:$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE=typeof Symbol==="function"&&typeof Symbol("x")==="symbol";$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;
$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b,c){if(!c||a!=null){c=$jscomp.propertyToPolyfillSymbol[b];if(c==null)return a[b];c=a[c];return c!==void 0?c:a[b]}};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&b!=null&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=e.length===1;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var h=e[f];if(!(h in d))return;d=d[h]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&c==="es6"?d[e]:null;b=b(c);b!=null&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]===void 0&&(c=Math.random()*1E9>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(f,h){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(Math.random()*1E9>>>0)+"_",d=0,e=function(f){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b(c+(f||"")+"_"+d++,f)};return e},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];typeof d==="function"&&typeof d.prototype[a]!="function"&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){if($jscomp.ASSUME_ES6)return a[Symbol.iterator]();a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&d=="q"&&e==b}}));return b.q===!0}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.makeIterator=function(a){var b=typeof Symbol!="undefined"&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if(typeof a.length=="number")return $jscomp.arrayIterator(a);throw Error(String(a)+" is not an iterable or ArrayLike");};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var k=Object.seal({}),l=Object.seal({}),m=new a([[k,2],[l,3]]);if(m.get(k)!=2||m.get(l)!=3)return!1;m.delete(k);m.set(l,4);return!m.has(k)&&m.get(l)==4}catch(p){return!1}}function c(){}function d(k){var l=typeof k;return l==="object"&&k!==null||l==="function"}function e(k){if(!$jscomp.owns(k,h)){var l=new c;$jscomp.defineProperty(k,h,{value:l})}}function f(k){if(!$jscomp.ISOLATE_POLYFILLS){var l=Object[k];l&&(Object[k]=
function(m){if(m instanceof c)return m;Object.isExtensible(m)&&e(m);return l(m)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var h="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var n=0,g=function(k){this.id_=(n+=Math.random()+1).toString();if(k){k=$jscomp.makeIterator(k);for(var l;!(l=k.next()).done;)l=l.value,this.set(l[0],l[1])}};g.prototype.set=function(k,l){if(!d(k))throw Error("Invalid WeakMap key");
e(k);if(!$jscomp.owns(k,h))throw Error("WeakMap key fail: "+k);k[h][this.id_]=l;return this};g.prototype.get=function(k){return d(k)&&$jscomp.owns(k,h)?k[h][this.id_]:void 0};g.prototype.has=function(k){return d(k)&&$jscomp.owns(k,h)&&$jscomp.owns(k[h],this.id_)};g.prototype.delete=function(k){return d(k)&&$jscomp.owns(k,h)&&$jscomp.owns(k[h],this.id_)?delete k[h][this.id_]:!1};return g},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||typeof a!="function"||!a.prototype.entries||typeof Object.seal!="function")return!1;try{var g=Object.seal({x:4}),k=new a($jscomp.makeIterator([[g,"s"]]));if(k.get(g)!="s"||k.size!=1||k.get({x:4})||k.set({x:4},"t")!=k||k.size!=2)return!1;var l=k.entries(),m=l.next();if(m.done||m.value[0]!=g||m.value[1]!="s")return!1;m=l.next();return m.done||m.value[0].x!=4||m.value[1]!="t"||!l.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(g){this[0]={};this[1]=h();this.size=0;if(g){g=$jscomp.makeIterator(g);for(var k;!(k=g.next()).done;)k=k.value,this.set(k[0],k[1])}};d.prototype.set=function(g,k){g=g===0?0:g;var l=e(this,g);l.list||(l.list=this[0][l.id]=[]);l.entry?l.entry.value=k:(l.entry={next:this[1],previous:this[1].previous,head:this[1],key:g,value:k},l.list.push(l.entry),this[1].previous.next=
l.entry,this[1].previous=l.entry,this.size++);return this};d.prototype.delete=function(g){g=e(this,g);return g.entry&&g.list?(g.list.splice(g.index,1),g.list.length||delete this[0][g.id],g.entry.previous.next=g.entry.next,g.entry.next.previous=g.entry.previous,g.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this[0]={};this[1]=this[1].previous=h();this.size=0};d.prototype.has=function(g){return!!e(this,g).entry};d.prototype.get=function(g){return(g=e(this,g).entry)&&g.value};d.prototype.entries=
function(){return f(this,function(g){return[g.key,g.value]})};d.prototype.keys=function(){return f(this,function(g){return g.key})};d.prototype.values=function(){return f(this,function(g){return g.value})};d.prototype.forEach=function(g,k){for(var l=this.entries(),m;!(m=l.next()).done;)m=m.value,g.call(k,m[1],m[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(g,k){var l=k&&typeof k;l=="object"||l=="function"?c.has(k)?l=c.get(k):(l=""+ ++n,c.set(k,l)):l="p_"+k;var m=g[0][l];
if(m&&$jscomp.owns(g[0],l))for(g=0;g<m.length;g++){var p=m[g];if(k!==k&&p.key!==p.key||k===p.key)return{id:l,list:m,index:g,entry:p}}return{id:l,list:m,index:-1,entry:void 0}},f=function(g,k){var l=g[1];return $jscomp.iteratorPrototype(function(){if(l){for(;l.head!=g[1];)l=l.previous;for(;l.next!=l.head;)return l=l.next,{done:!1,value:k(l)};l=null}return{done:!0,value:void 0}})},h=function(){var g={};return g.previous=g.next=g.head=g},n=0;return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||typeof a!="function"||!a.prototype.entries||typeof Object.seal!="function")return!1;try{var d=Object.seal({x:4}),e=new a($jscomp.makeIterator([d]));if(!e.has(d)||e.size!=1||e.add(d)!=e||e.size!=1||e.add({x:4})!=e||e.size!=2)return!1;var f=e.entries(),h=f.next();if(h.done||h.value[0]!=d||h.value[1]!=d)return!1;h=f.next();return h.done||h.value[0]==d||h.value[0].x!=4||h.value[1]!=h.value[0]?!1:f.next().done}catch(n){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size};c.prototype.add=function(d){d=d===0?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};c.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};c.prototype.clear=function(){this.map_.clear();this.size=0};c.prototype.has=
function(d){return this.map_.has(d)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(d,e){var f=this;this.map_.forEach(function(h){return d.call(e,h,h,f)})};return c},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;c<0&&(c=Math.max(0,e+c));if(d==null||d>e)d=e;d=Number(d);d<0&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
var WaveSurfer={defaultParams:{audioContext:null,audioRate:1,autoCenter:!0,autoCenterSpeed:5,backend:"WebAudio",barHeight:1,closeAudioContext:!1,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,progressColor:"#555",normalize:!1,renderer:"MultiCanvas",
scrollParent:!1,sendCredentials:!1,skipLength:2,splitChannels:!1,waveColor:"#999"},init:function(a){this.params=WaveSurfer.util.extend({},this.defaultParams,a);this.container="string"==typeof a.container?document.querySelector(this.params.container):this.params.container;if(!this.container)throw Error("Container element not found");this.mediaContainer=this.params.mediaContainer==null?this.container:typeof this.params.mediaContainer=="string"?document.querySelector(this.params.mediaContainer):this.params.mediaContainer;
if(!this.mediaContainer)throw Error("Media Container element not found");this.savedVolume=0;this.isMuted=!1;this.tmpEvents=[];this.currentAjax=null;this.createDrawer();this.createBackend();this.createPeakCache();this.isDestroyed=!1},createDrawer:function(){var a=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]);this.drawer.init(this.container,this.params);this.drawer.on("redraw",function(){a.drawBuffer();a.drawer.progress(a.backend.getPlayedPercents())});this.drawer.on("click",
function(b,c){setTimeout(function(){a.seekTo(c)},0)});this.drawer.on("scroll",function(b){a.params.partialRender&&a.drawBuffer();a.fireEvent("scroll",b)})},createBackend:function(){var a=this;this.backend&&this.backend.destroy();this.params.backend=="AudioElement"&&(this.params.backend="MediaElement");this.params.backend!="WebAudio"||WaveSurfer.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement");this.backend=Object.create(WaveSurfer[this.params.backend]);this.backend.init(this.params);
this.backend.on("finish",function(){a.fireEvent("finish")});this.backend.on("play",function(){a.fireEvent("play")});this.backend.on("pause",function(){a.fireEvent("pause")});this.backend.on("audioprocess",function(b){a.drawer.progress(a.backend.getPlayedPercents());a.fireEvent("audioprocess",b)})},createPeakCache:function(){this.params.partialRender&&(this.peakCache=Object.create(WaveSurfer.PeakCache),this.peakCache.init())},getDuration:function(){return this.backend.getDuration()},play:function(a,
b){this.fireEvent("interaction",this.play.bind(this,a,b));this.backend.play(a,b)},pause:function(){this.backend.isPaused()||this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(a){this.skip(-a||-this.params.skipLength)},skipForward:function(a){this.skip(a||this.params.skipLength)},skip:function(a){var b=this.getCurrentTime()||0,c=this.getDuration()||1;b=Math.max(0,Math.min(c,b+(a||0)));
this.seekAndCenter(b/c)},seekAndCenter:function(a){this.seekTo(a);this.drawer.recenter(a)},seekTo:function(a){a=Math.max(0,a);this.fireEvent("interaction",this.seekTo.bind(this,a));var b=this.backend.isPaused();b||this.backend.pause();var c=this.params.scrollParent;this.params.scrollParent=!1;this.backend.seekTo(a*this.getDuration());this.drawer.progress(this.backend.getPlayedPercents());b||this.backend.play();this.params.scrollParent=c;this.fireEvent("seek",a)},stop:function(){this.pause();this.seekTo(0);
this.drawer.progress(0)},setVolume:function(a){this.backend.setVolume(a)},getVolume:function(){return this.backend.getVolume()},getCurrentTime:function(){return this.backend.getCurrentTime()},setCurrentTime:function(a){a>=this.getDuration()?this.seekTo(1):this.seekTo(a/this.getDuration())},setPlaybackRate:function(a){this.backend.setPlaybackRate(a)},getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(a){a!==this.isMuted&&
(a?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent;this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var a=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),
b=this.drawer.getWidth(),c=a,d=this.drawer.getScrollX(),e=Math.min(d+b,c);this.params.fillParent&&(!this.params.scrollParent||a<b)&&(c=b,d=0,e=c);if(this.params.partialRender)for(a=this.peakCache.addRangeToPeakCache(c,d,e),b=0;b<a.length;b++){var f=this.backend.getPeaks(c,a[b][0],a[b][1]);this.drawer.drawPeaks(f,c,a[b][0],a[b][1])}else d=0,e=c,f=this.backend.getPeaks(c,d,e),this.drawer.drawPeaks(f,c,d,e);this.fireEvent("redraw",f,c)},zoom:function(a){this.params.minPxPerSec=a;this.params.scrollParent=
!0;this.drawBuffer();this.drawer.progress(this.backend.getPlayedPercents());this.drawer.recenter(this.getCurrentTime()/this.getDuration());this.fireEvent("zoom",a)},loadArrayBuffer:function(a){this.decodeArrayBuffer(a,function(b){this.isDestroyed||this.loadDecodedBuffer(b)}.bind(this))},loadDecodedBuffer:function(a){this.backend.load(a);this.drawBuffer();this.fireEvent("ready")},loadBlob:function(a){var b=this,c=new FileReader;c.addEventListener("progress",function(d){b.onProgress(d)});c.addEventListener("load",
function(d){b.loadArrayBuffer(d.target.result)});c.addEventListener("error",function(){b.fireEvent("error","Error reading file")});c.readAsArrayBuffer(a);this.empty()},load:function(a,b,c){this.empty();this.isMuted=!1;switch(this.params.backend){case "WebAudio":return this.loadBuffer(a,b);case "MediaElement":return this.loadMediaElement(a,b,c)}},loadBuffer:function(a,b){var c=function(d){d&&this.tmpEvents.push(this.once("ready",d));return this.getArrayBuffer(a,this.loadArrayBuffer.bind(this))}.bind(this);
if(b)this.backend.setPeaks(b),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",c));else return c()},loadMediaElement:function(a,b,c){var d=a;typeof a==="string"?this.backend.load(d,this.mediaContainer,b,c):(this.backend.loadElt(a,b),d=a.src);this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer();this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(e){this.fireEvent("error",e)}.bind(this)));b&&this.backend.setPeaks(b);b&&!this.params.forceDecode||
!this.backend.supportsWebAudio()||this.getArrayBuffer(d,function(e){this.decodeArrayBuffer(e,function(f){this.backend.buffer=f;this.backend.setPeaks(null);this.drawBuffer();this.fireEvent("waveform-ready")}.bind(this))}.bind(this))},decodeArrayBuffer:function(a,b){this.arraybuffer=a;this.backend.decodeArrayBuffer(a,function(c){this.isDestroyed||this.arraybuffer!=a||(b(c),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(a,b){var c=
this;this.currentAjax=a=WaveSurfer.util.ajax({url:a,responseType:"arraybuffer",sendCredentials:this.params.sendCredentials});this.tmpEvents.push(a.on("progress",function(d){c.onProgress(d)}),a.on("success",function(d,e){b(d);c.currentAjax=null}),a.on("error",function(d){c.fireEvent("error","XHR error: "+d.target.statusText);c.currentAjax=null}));return a},onProgress:function(a){this.fireEvent("loading",Math.round((a.lengthComputable?a.loaded/a.total:a.loaded/(a.loaded+1E6))*100),a.target)},exportPCM:function(a,
b,c,d){b=b||1E4;c=c||!1;a=this.backend.getPeaks(a||1024,d||0);a=[].map.call(a,function(e){return Math.round(e*b)/b});a=JSON.stringify(a);c||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(a));return a},exportImage:function(a,b){a||(a="image/png");b||(b=1);return this.drawer.getImage(a,b)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(a){a.un()})},empty:function(){this.backend.isPaused()||
(this.stop(),this.backend.disconnectSource());this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);this.drawer.setWidth(0);this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();this.backend.destroy();this.drawer.destroy();this.isDestroyed=!0},create:function(a){var b=Object.create(WaveSurfer);b.init(a);return b}};window.WaveSurfer=WaveSurfer;WaveSurfer.util={requestAnimationFrame:(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){setTimeout(a,1E3/60)}).bind(window),frame:function(a){return function(){var b=this,c=arguments;WaveSurfer.util.requestAnimationFrame(function(){a.apply(b,c)})}},extend:function(a){Array.prototype.slice.call(arguments,1).forEach(function(b){Object.keys(b).forEach(function(c){a[c]=b[c]})});
return a},debounce:function(a,b,c){var d,e,f,h=function(){f=null;c||a.apply(e,d)};return function(){e=this;d=arguments;var n=c&&!f;clearTimeout(f);(f=setTimeout(h,b))||(f=setTimeout(h,b));n&&a.apply(e,d)}},min:function(a){var b=Infinity,c;for(c in a)a[c]<b&&(b=a[c]);return b},max:function(a){var b=-Infinity,c;for(c in a)a[c]>b&&(b=a[c]);return b},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(a){var b=Object.create(WaveSurfer.Observer),c=new XMLHttpRequest,
d=!1;c.open(a.method||"GET",a.url,!0);c.responseType=a.responseType||"json";c.addEventListener("progress",function(e){b.fireEvent("progress",e);e.lengthComputable&&e.loaded==e.total&&(d=!0)});c.addEventListener("load",function(e){d||b.fireEvent("progress",e);b.fireEvent("load",e);200==c.status||206==c.status?b.fireEvent("success",c.response,e):b.fireEvent("error",e)});c.addEventListener("error",function(e){b.fireEvent("error",e)});c.withCredentials=a.sendCredentials||!1;c.send();b.xhr=c;return b}};
WaveSurfer.Observer={on:function(a,b){this.handlers||(this.handlers={});var c=this.handlers[a];c||(c=this.handlers[a]=[]);c.push(b);return{name:a,callback:b,un:this.un.bind(this,a,b)}},un:function(a,b){if(this.handlers&&(a=this.handlers[a]))if(b)for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);else a.length=0},unAll:function(){this.handlers=null},once:function(a,b){var c=this,d=function(){b.apply(this,arguments);setTimeout(function(){c.un(a,d)},0)};return this.on(a,d)},fireEvent:function(a){if(this.handlers){var b=
this.handlers[a],c=Array.prototype.slice.call(arguments,1);b&&b.forEach(function(d){d.apply(null,c)})}}};WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer);WaveSurfer.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new (window.AudioContext||window.webkitAudioContext));return WaveSurfer.WebAudio.audioContext},getOfflineAudioContext:function(a){WaveSurfer.WebAudio.offlineAudioContext||(WaveSurfer.WebAudio.offlineAudioContext=new (window.OfflineAudioContext||
window.webkitOfflineAudioContext)(1,2,a));return WaveSurfer.WebAudio.offlineAudioContext},init:function(a){this.params=a;this.ac=a.audioContext||this.getAudioContext();this.lastPlay=this.ac.currentTime;this.startPosition=0;this.scheduledPause=null;this.states=[Object.create(WaveSurfer.WebAudio.state.playing),Object.create(WaveSurfer.WebAudio.state.paused),Object.create(WaveSurfer.WebAudio.state.finished)];this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState(this.PAUSED_STATE);
this.setPlaybackRate(this.params.audioRate);this.setLength(0)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(a){a&&a.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(a){this.state!==this.states[a]&&(this.state=this.states[a],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(a){this.disconnectFilters();a&&a.length&&(this.filters=a,this.analyser.disconnect(),a.reduce(function(b,
c){b.connect(c);return c},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(this.scriptBufferSize):this.ac.createJavaScriptNode(this.scriptBufferSize);this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var a=this;this.scriptNode.onaudioprocess=function(){var b=a.getCurrentTime();b>=a.getDuration()?(a.setState(a.FINISHED_STATE),a.fireEvent("pause")):b>=a.scheduledPause?a.pause():a.state===
a.states[a.PLAYING_STATE]&&a.fireEvent("audioprocess",b)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser();this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode();this.gainNode.connect(this.ac.destination)},setVolume:function(a){this.gainNode.gain.value=a},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(a,
b,c){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100));this.offlineAc.decodeAudioData(a,function(d){b(d)}.bind(this),c)},setPeaks:function(a){this.peaks=a},setLength:function(a){if(!this.mergedPeaks||a!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[];this.mergedPeaks=[];for(var b=this.buffer?this.buffer.numberOfChannels:1,c=0;c<b;c++)this.splitPeaks[c]=[],this.splitPeaks[c][2*(a-1)]=0,this.splitPeaks[c][2*(a-1)+1]=0;this.mergedPeaks[2*(a-1)]=0;this.mergedPeaks[2*
(a-1)+1]=0}},getPeaks:function(a,b,c){if(this.peaks)return this.peaks;b=b||0;c=c||a-1;this.setLength(a);this.buffer.length||(this.buffer=this.createBuffer(1,4096,this.sampleRate).buffer);a=this.buffer.length/a;for(var d=~~(a/10)||1,e=this.buffer.numberOfChannels,f=0;f<e;f++)for(var h=this.splitPeaks[f],n=this.buffer.getChannelData(f),g=b;g<=c;g++){for(var k=~~(g*a),l=~~(k+a),m=0,p=0;k<l;k+=d){var q=n[k];q>p&&(p=q);q<m&&(m=q)}h[2*g]=p;h[2*g+1]=m;if(f==0||p>this.mergedPeaks[2*g])this.mergedPeaks[2*
g]=p;if(f==0||m<this.mergedPeaks[2*g+1])this.mergedPeaks[2*g+1]=m}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause();this.unAll();this.buffer=null;this.disconnectFilters();this.disconnectSource();this.gainNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect();this.params.closeAudioContext&&
(typeof this.ac.close==="function"&&this.ac.state!="closed"&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:WaveSurfer.WebAudio.audioContext=null,WaveSurfer.WebAudio.offlineAudioContext=null)},load:function(a){this.startPosition=0;this.lastPlay=this.ac.currentTime;this.buffer=a;this.createSource()},createSource:function(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=
this.source.stop||this.source.noteOff;this.source.playbackRate.value=this.playbackRate;this.source.buffer=this.buffer;this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(a,b){if(this.buffer)return this.scheduledPause=null,a==null&&(a=this.getCurrentTime(),a>=this.getDuration()&&(a=0)),b==null&&(b=this.getDuration()),this.startPosition=a,this.lastPlay=this.ac.currentTime,
this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:a,end:b}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(a,b){this.buffer&&(this.createSource(),b=this.seekTo(a,b),a=b.start,this.scheduledPause=b=b.end,this.source.start(0,a,b-a),this.ac.state=="suspended"&&this.ac.resume&&this.ac.resume(),this.setState(this.PLAYING_STATE),this.fireEvent("play"))},pause:function(){this.scheduledPause=null;this.startPosition+=
this.getPlayedTime();this.source&&this.source.stop(0);this.setState(this.PAUSED_STATE);this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(a){a=a||1;this.isPaused()?this.playbackRate=a:(this.pause(),this.playbackRate=a,this.play())}};WaveSurfer.WebAudio.state={};
WaveSurfer.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}};WaveSurfer.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition}};
WaveSurfer.WebAudio.state.finished={init:function(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}};WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer);WaveSurfer.MediaElement=Object.create(WaveSurfer.WebAudio);
WaveSurfer.util.extend(WaveSurfer.MediaElement,{init:function(a){this.params=a;this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}};this.mediaType=a.mediaType.toLowerCase();this.elementPosition=a.elementPosition;this.setPlaybackRate(this.params.audioRate);this.createTimer()},createTimer:function(){var a=this,b=function(){a.isPaused()||(a.fireEvent("audioprocess",a.getCurrentTime()),(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(b))};
this.on("play",b)},load:function(a,b,c,d){var e=document.createElement(this.mediaType);e.controls=this.params.mediaControls;e.autoplay=this.params.autoplay||!1;e.preload=d==null?"auto":d;e.src=a;e.style.width="100%";(a=b.querySelector(this.mediaType))&&b.removeChild(a);b.appendChild(e);this._load(e,c)},loadElt:function(a,b){a.controls=this.params.mediaControls;a.autoplay=this.params.autoplay||!1;this._load(a,b)},_load:function(a,b){var c=this;typeof a.load=="function"&&a.load();a.addEventListener("error",
function(){c.fireEvent("error","Error loading media element")});a.addEventListener("canplay",function(){c.fireEvent("canplay")});a.addEventListener("ended",function(){c.fireEvent("finish")});a.addEventListener("play",function(){c.fireEvent("play")});a.addEventListener("pause",function(){c.fireEvent("pause")});this.media=a;this.peaks=b;this.buffer=this.onPlayEnd=null;this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var a=(this.buffer||
this.media).duration;a>=Infinity&&(a=this.media.seekable.end(0));return a},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},getPlaybackRate:function(){return this.playbackRate||this.media.playbackRate},setPlaybackRate:function(a){this.playbackRate=a||1;this.media.playbackRate=this.playbackRate},seekTo:function(a){a!=null&&(this.media.currentTime=a);this.clearPlayEnd()},play:function(a,b){this.seekTo(a);
this.media.play();b&&this.setPlayEnd(b)},pause:function(){this.media&&this.media.pause();this.clearPlayEnd()},setPlayEnd:function(a){var b=this;this.onPlayEnd=function(c){c>=a&&(b.pause(),b.seekTo(a))};this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(a,b,c){return this.buffer?WaveSurfer.WebAudio.getPeaks.call(this,a,b,c):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(a){this.media.volume=
a},destroy:function(){this.pause();this.unAll();this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media);this.media=null}});WaveSurfer.AudioElement=WaveSurfer.MediaElement;WaveSurfer.Drawer={init:function(a,b){this.container=a;this.params=b;this.width=0;this.height=b.height*this.params.pixelRatio;this.lastPos=0;this.pendingAnimations=new Set;this.initDrawer(b);this.createWrapper();this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});(this.params.fillParent||this.params.scrollParent)&&
this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"});this.setupWrapperEvents()},handleEvent:function(a,b){!b&&a.preventDefault();a=a.targetTouches?a.targetTouches[0].clientX:a.clientX;b=this.wrapper.getBoundingClientRect();var c=this.width,d=this.getWidth();!this.params.fillParent&&c<d?(a=(a-b.left)*this.params.pixelRatio/c||0,a>1&&(a=1)):a=(a-b.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0;return a},setupWrapperEvents:function(){var a=
this;this.wrapper.addEventListener("click",function(b){var c=a.wrapper.offsetHeight-a.wrapper.clientHeight;if(c!=0){var d=a.wrapper.getBoundingClientRect();if(b.clientY>=d.bottom-c)return}a.params.interact&&a.fireEvent("click",b,a.handleEvent(b))});this.wrapper.addEventListener("scroll",function(b){a.fireEvent("scroll",b)})},drawPeaks:function(a,b,c,d){this.pendingAnimations.forEach(function(e){return window.cancelAnimationFrame(e)});this.pendingAnimations.clear();this.setWidth(b)||this.clearWave();
this.params.barWidth?this.drawBars(a,0,c,d):this.drawWave(a,0,c,d)},style:function(a,b){Object.keys(b).forEach(function(c){a.style[c]!==b[c]&&(a.style[c]=b[c])});return a},resetScroll:function(){this.wrapper!==null&&(this.wrapper.scrollLeft=0)},recenter:function(a){this.recenterOnPosition(this.wrapper.scrollWidth*a,!0)},recenterOnPosition:function(a,b){var c=this.wrapper.scrollLeft,d=~~(this.wrapper.clientWidth/2),e=a-d;a=e-c;var f=this.wrapper.scrollWidth-this.wrapper.clientWidth;f!=0&&(!b&&-d<=
a&&a<d&&(b=this.params.autoCenterSpeed,a=Math.max(-b,Math.min(b,a)),e=c+a),e=Math.max(0,Math.min(f,e)),e!=c&&(this.wrapper.scrollLeft=e))},getScrollX:function(){return Math.round(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(a){if(this.width==a)return!1;this.width=a;this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/
this.params.pixelRatio)+"px"});this.updateSize();return!0},setHeight:function(a){if(a==this.height)return!1;this.height=a;this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"});this.updateSize();return!0},progress:function(a){var b=1/this.params.pixelRatio,c=Math.round(a*this.width)*b;if(c<this.lastPos||c-this.lastPos>=b)this.lastPos=c,this.params.scrollParent&&this.params.autoCenter&&this.recenterOnPosition(~~(this.wrapper.scrollWidth*a)),this.updateProgress(c)},destroy:function(){this.unAll();
this.wrapper&&(this.wrapper.parentNode==this.container&&this.container.removeChild(this.wrapper),this.wrapper=null)},cancellableFrame:function(a){return function(){var b=this,c=arguments,d=WaveSurfer.util.requestAnimationFrame(function(){b.pendingAnimations.delete(d);a.apply(b,c)});b.pendingAnimations.add(d)}},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(a,b){},clearWave:function(){},updateProgress:function(a){}};
WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer);WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer);
WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){this.waveCc=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0,pointerEvents:"none"})).getContext("2d");this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+
"px",borderRightColor:this.params.cursorColor,pointerEvents:"none"}));this.params.waveColor!=this.params.progressColor&&(this.progressCc=this.progressWave.appendChild(document.createElement("canvas")).getContext("2d"))},updateSize:function(){var a=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width;this.waveCc.canvas.height=this.height;this.style(this.waveCc.canvas,{width:a+"px"});this.style(this.progressWave,{display:"block"});this.progressCc&&(this.progressCc.canvas.width=
this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:a+"px"}));this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height);this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawBars:WaveSurfer.Drawer.cancellableFrame(function(a,b,c,d){var e=this;if(a[0]instanceof Array){var f=a;if(this.params.splitChannels){this.setHeight(f.length*this.params.height*this.params.pixelRatio);f.forEach(function(u,v){e.drawBars(u,
v,c,d)});return}a=f[0]}var h=1;[].some.call(a,function(u){return u<0})&&(h=2);var n=.5/this.params.pixelRatio;f=this.width;var g=this.params.height*this.params.pixelRatio,k=g*b||0,l=g/2;b=a.length/h;var m=this.params.barWidth*this.params.pixelRatio,p=m+Math.max(this.params.pixelRatio,~~(m/2)),q=1/this.params.barHeight;if(this.params.normalize){g=WaveSurfer.util.max(a);var r=WaveSurfer.util.min(a);q=-r>g?-r:g}var t=b/f;this.waveCc.fillStyle=this.params.waveColor;this.progressCc&&(this.progressCc.fillStyle=
this.params.progressColor);[this.waveCc,this.progressCc].forEach(function(u){if(u)for(var v=c/t;v<d/t;v+=p){var w=Math.round((a[Math.floor(v*t*h)]||0)/q*l);u.fillRect(v+n,l-w+k,m+n,w*2)}},this)}),drawWave:WaveSurfer.Drawer.cancellableFrame(function(a,b,c,d){var e=this;if(a[0]instanceof Array){var f=a;if(this.params.splitChannels){this.setHeight(f.length*this.params.height*this.params.pixelRatio);f.forEach(function(q,r){e.drawWave(q,r,c,d)});return}a=f[0]}if(![].some.call(a,function(q){return q<0})){f=
[];for(var h=0,n=a.length;h<n;h++)f[2*h]=a[h],f[2*h+1]=-a[h];a=f}var g=.5/this.params.pixelRatio;f=this.params.height*this.params.pixelRatio;var k=f*b||0,l=f/2;b=~~(a.length/2);var m=1;this.params.fillParent&&this.width!=b&&(m=this.width/b);var p=1/this.params.barHeight;this.params.normalize&&(b=WaveSurfer.util.max(a),f=WaveSurfer.util.min(a),p=-f>b?-f:b);this.waveCc.fillStyle=this.params.waveColor;this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor);[this.waveCc,this.progressCc].forEach(function(q){if(q){q.beginPath();
q.moveTo(c*m+g,l+k);for(var r=c;r<d;r++){var t=Math.round(a[2*r]/p*l);q.lineTo(r*m+g,l-t+k)}for(r=d-1;r>=c;r--)t=Math.round(a[2*r+1]/p*l),q.lineTo(r*m+g,l-t+k);q.closePath();q.fill();q.fillRect(0,l+k-g,this.width,g)}},this)}),updateProgress:function(a){this.style(this.progressWave,{width:a+"px"})},getImage:function(a,b){return this.waveCc.canvas.toDataURL(a,b)}});WaveSurfer.Drawer.MultiCanvas=Object.create(WaveSurfer.Drawer);
WaveSurfer.util.extend(WaveSurfer.Drawer.MultiCanvas,{initDrawer:function(a){this.maxCanvasWidth=a.maxCanvasWidth!=null?a.maxCanvasWidth:4E3;this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio);if(this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor;this.halfPixel=.5/this.params.pixelRatio;this.canvases=[]},createElements:function(){this.progressWave=
this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor,pointerEvents:"none"}));this.addCanvas()},updateSize:function(){for(var a=Math.ceil(Math.round(this.width/this.params.pixelRatio)/this.maxCanvasElementWidth);this.canvases.length<a;)this.addCanvas();for(;this.canvases.length>
a;)this.removeCanvas();this.canvases.forEach(function(b,c){var d=this.maxCanvasWidth+2*Math.ceil(this.params.pixelRatio/2);c==this.canvases.length-1&&(d=this.width-this.maxCanvasWidth*(this.canvases.length-1));this.updateDimensions(b,d,this.height);this.clearWaveForEntry(b)},this)},addCanvas:function(){var a={},b=this.maxCanvasElementWidth*this.canvases.length;a.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:b+"px",top:0,bottom:0,height:"100%",
pointerEvents:"none"}));a.waveCtx=a.wave.getContext("2d");this.hasProgressCanvas&&(a.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:b+"px",top:0,bottom:0,height:"100%"})),a.progressCtx=a.progress.getContext("2d"));this.canvases.push(a)},removeCanvas:function(){var a=this.canvases.pop();a.wave.parentElement.removeChild(a.wave);this.hasProgressCanvas&&a.progress.parentElement.removeChild(a.progress)},updateDimensions:function(a,b,c){var d=
Math.round(b/this.params.pixelRatio),e=Math.round(this.width/this.params.pixelRatio);a.start=a.waveCtx.canvas.offsetLeft/e||0;a.end=a.start+d/e;a.waveCtx.canvas.width=b;a.waveCtx.canvas.height=c;this.style(a.waveCtx.canvas,{width:d+"px"});this.style(this.progressWave,{display:"block"});this.hasProgressCanvas&&(a.progressCtx.canvas.width=b,a.progressCtx.canvas.height=c,this.style(a.progressCtx.canvas,{width:d+"px"}))},clearWave:function(){this.canvases.forEach(function(a){this.clearWaveForEntry(a)},
this)},clearWaveForEntry:function(a){a.waveCtx.clearRect(0,0,a.waveCtx.canvas.width,a.waveCtx.canvas.height);this.hasProgressCanvas&&a.progressCtx.clearRect(0,0,a.progressCtx.canvas.width,a.progressCtx.canvas.height)},drawBars:WaveSurfer.Drawer.cancellableFrame(function(a,b,c,d){if(a[0]instanceof Array){if(this.params.splitChannels){this.setHeight(a.length*this.params.height*this.params.pixelRatio);a.forEach(function(p,q){this.drawBars(p,q,c,d)},this);return}a=a[0]}var e=1;[].some.call(a,function(p){return p<
0})&&(e=2);var f=this.width,h=this.params.height*this.params.pixelRatio;b=h*b||0;h/=2;var n=a.length/e,g=this.params.barWidth*this.params.pixelRatio,k=g+Math.max(this.params.pixelRatio,~~(g/2)),l=1/this.params.barHeight;if(this.params.normalize){l=WaveSurfer.util.max(a);var m=WaveSurfer.util.min(a);l=-m>l?-m:l}f=n/f;for(n=c/f;n<d/f;n+=k)m=Math.round((a[Math.floor(n*f*e)]||0)/l*h),this.fillRect(n+this.halfPixel,h-m+b,g+this.halfPixel,m*2)}),drawWave:WaveSurfer.Drawer.cancellableFrame(function(a,b,
c,d){if(a[0]instanceof Array){if(this.params.splitChannels){this.setHeight(a.length*this.params.height*this.params.pixelRatio);a.forEach(function(n,g){this.drawWave(n,g,c,d)},this);return}a=a[0]}if(![].some.call(a,function(n){return n<0})){for(var e=[],f=0,h=a.length;f<h;f++)e[2*f]=a[f],e[2*f+1]=-a[f];a=e}e=this.params.height*this.params.pixelRatio;b=e*b||0;e/=2;f=1/this.params.barHeight;this.params.normalize&&(f=WaveSurfer.util.max(a),h=WaveSurfer.util.min(a),f=-h>f?-h:f);this.drawLine(a,f,e,b,c,
d);this.fillRect(0,e+b-this.halfPixel,this.width,this.halfPixel)}),drawLine:function(a,b,c,d,e,f){this.canvases.forEach(function(h){this.setFillStyles(h);this.drawLineToContext(h,h.waveCtx,a,b,c,d,e,f);this.drawLineToContext(h,h.progressCtx,a,b,c,d,e,f)},this)},drawLineToContext:function(a,b,c,d,e,f,h,n){if(b){var g=c.length/2,k=this.params.fillParent&&this.width!=g?this.width/g:1,l=Math.round(g*a.start);a=Math.round(g*a.end)+1;if(!(l>n||a<h)){h=Math.max(l,h);n=Math.min(a,n);b.beginPath();b.moveTo((h-
l)*k+this.halfPixel,e+f);for(a=h;a<n;a++)g=c[2*a]||0,g=Math.round(g/d*e),b.lineTo((a-l)*k+this.halfPixel,e-g+f);for(a=n-1;a>=h;a--)g=c[2*a+1]||0,g=Math.round(g/d*e),b.lineTo((a-l)*k+this.halfPixel,e-g+f);b.closePath();b.fill()}}},fillRect:function(a,b,c,d){for(var e=Math.min(Math.ceil((a+c)/this.maxCanvasWidth)+1,this.canvases.length),f=Math.floor(a/this.maxCanvasWidth);f<e;f++){var h=this.canvases[f],n=f*this.maxCanvasWidth,g=Math.max(a,f*this.maxCanvasWidth),k=b,l=Math.min(a+c,f*this.maxCanvasWidth+
h.waveCtx.canvas.width),m=b+d;g<l&&(this.setFillStyles(h),this.fillRectToContext(h.waveCtx,g-n,k,l-g,m-k),this.fillRectToContext(h.progressCtx,g-n,k,l-g,m-k))}},fillRectToContext:function(a,b,c,d,e){a&&a.fillRect(b,c,d,e)},setFillStyles:function(a){a.waveCtx.fillStyle=this.params.waveColor;this.hasProgressCanvas&&(a.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(a){this.style(this.progressWave,{width:a+"px"})},getImage:function(a,b){var c=[];this.canvases.forEach(function(d){c.push(d.wave.toDataURL(a,
b))});return c.length>1?c:c[0]}});WaveSurfer.Drawer.SplitWavePointPlot=Object.create(WaveSurfer.Drawer.Canvas);
WaveSurfer.util.extend(WaveSurfer.Drawer.SplitWavePointPlot,{defaultPlotParams:{plotNormalizeTo:"whole",plotTimeStart:0,plotMin:0,plotMax:1,plotColor:"#f63",plotProgressColor:"#F00",plotPointHeight:2,plotPointWidth:2,plotSeparator:!0,plotSeparatorColor:"black",plotRangeDisplay:!1,plotRangeUnits:"",plotRangePrecision:4,plotRangeIgnoreOutliers:!1,plotRangeFontSize:12,plotRangeFontType:"Ariel",waveDrawMedianLine:!0,plotFileDelimiter:"\t"},plotTimeStart:0,plotTimeEnd:-1,plotArrayLoaded:!1,plotArray:[],
plotPoints:[],plotMin:0,plotMax:1,initDrawer:function(a){var b=this,c;for(c in this.defaultPlotParams)this.params[c]===void 0&&(this.params[c]=this.defaultPlotParams[c]);this.plotTimeStart=this.params.plotTimeStart;this.params.plotTimeEnd!==void 0&&(this.plotTimeEnd=this.params.plotTimeEnd);Array.isArray(a.plotArray)?(this.plotArray=a.plotArray,this.plotArrayLoaded=!0):this.loadPlotArrayFromFile(a.plotFileUrl,function(d){b.plotArray=d;b.plotArrayLoaded=!0;b.fireEvent("plot_array_loaded")},this.params.plotFileDelimiter)},
drawPeaks:function(a,b,c,d){if(this.plotArrayLoaded==1)this.setWidth(b),this.splitChannels=!0,this.params.height/=2,a[0]instanceof Array&&(a=a[0]),this.params.barWidth?this.drawBars(a,1,c,d):this.drawWave(a,1,c,d),this.params.height*=2,this.calculatePlots(),this.drawPlots();else{var e=this;e.on("plot-array-loaded",function(){e.drawPeaks(a,b,c,d)})}},drawPlots:function(){var a=this.params.height*this.params.pixelRatio/2,b=.5/this.params.pixelRatio;this.waveCc.fillStyle=this.params.plotColor;this.progressCc&&
(this.progressCc.fillStyle=this.params.plotProgressColor);for(var c in this.plotPoints){var d=parseInt(c),e=a-this.params.plotPointHeight-this.plotPoints[c]*(a-this.params.plotPointHeight),f=this.params.plotPointHeight;this.waveCc.fillRect(d,e,this.params.plotPointWidth,f);this.progressCc&&this.progressCc.fillRect(d,e,this.params.plotPointWidth,f)}this.params.plotSeparator&&(this.waveCc.fillStyle=this.params.plotSeparatorColor,this.waveCc.fillRect(0,a,this.width,b));this.params.plotRangeDisplay&&
this.displayPlotRange()},displayPlotRange:function(){var a=this.params.plotRangeFontSize*this.params.pixelRatio,b=this.plotMax.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits,c=this.plotMin.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits;this.waveCc.font=a.toString()+"px "+this.params.plotRangeFontType;this.waveCc.fillText(b,3,a);this.waveCc.fillText(c,3,this.height/2)},calculatePlots:function(){this.plotPoints={};this.calculatePlotTimeEnd();for(var a=
[],b=-1,c=0,d=99999999999999,e=0,f=99999999999999,h=this.plotTimeEnd-this.plotTimeStart,n=0;n<this.plotArray.length;n++){var g=this.plotArray[n];g.value>c&&(c=g.value);g.value<d&&(d=g.value);if(g.time>=this.plotTimeStart&&g.time<=this.plotTimeEnd){var k=Math.round(this.width*(g.time-this.plotTimeStart)/h);a.push(g.value);k!==b&&a.length>0&&(a=this.avg(a),a>e&&(e=a),a<f&&(f=a),this.plotPoints[b]=a,a=[]);b=k}}this.params.plotNormalizeTo=="whole"?(this.plotMin=d,this.plotMax=c):this.params.plotNormalizeTo==
"values"?(this.plotMin=this.params.plotMin,this.plotMax=this.params.plotMax):(this.plotMin=f,this.plotMax=e);this.normalizeValues()},normalizeValues:function(){var a={};if(this.params.plotNormalizeTo!=="none"){for(var b in this.plotPoints){var c=(this.plotPoints[b]-this.plotMin)/(this.plotMax-this.plotMin);c>1?this.params.plotRangeIgnoreOutliers||(a[b]=1):c<0?this.params.plotRangeIgnoreOutliers||(a[b]=0):a[b]=c}this.plotPoints=a}},loadPlotArrayFromFile:function(a,b,c){c===void 0&&(c="\t");var d=[];
WaveSurfer.util.ajax({url:a,responseType:"text"}).on("load",function(e){if(e.currentTarget.status==200){e=e.currentTarget.responseText.split("\n");for(var f=0;f<e.length;f++){var h=e[f].split(c);h.length==2&&d.push({time:parseFloat(h[0]),value:parseFloat(h[1])})}b(d)}})},calculatePlotTimeEnd:function(){this.plotTimeEnd=this.params.plotTimeEnd!==void 0?this.params.plotTimeEnd:this.plotArray[this.plotArray.length-1].time},avg:function(a){return a.reduce(function(b,c){return b+c})/a.length}});
WaveSurfer.util.extend(WaveSurfer.Drawer.SplitWavePointPlot,WaveSurfer.Observer);WaveSurfer.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=[];this.peakCacheLength=-1},addRangeToPeakCache:function(a,b,c){a!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=a);a=[];for(var d=0;d<this.peakCacheRanges.length&&this.peakCacheRanges[d]<b;)d++;for(d%2==0&&a.push(b);d<this.peakCacheRanges.length&&this.peakCacheRanges[d]<=c;)a.push(this.peakCacheRanges[d]),d++;d%2==0&&a.push(c);a=a.filter(function(e,f,h){return f==0?e!=h[f+
1]:f==h.length-1?e!=h[f-1]:e!=h[f-1]&&e!=h[f+1]});this.peakCacheRanges=this.peakCacheRanges.concat(a);this.peakCacheRanges=this.peakCacheRanges.sort(function(e,f){return e-f}).filter(function(e,f,h){return f==0?e!=h[f+1]:f==h.length-1?e!=h[f-1]:e!=h[f-1]&&e!=h[f+1]});b=[];for(d=0;d<a.length;d+=2)b.push([a[d],a[d+1]]);return b},getCacheRanges:function(){for(var a=[],b=0;b<this.peakCacheRanges.length;b+=2)a.push([this.peakCacheRanges[b],this.peakCacheRanges[b+1]]);return a}};(function(){var a=function(){var b=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(b,function(c){var d=WaveSurfer.util.extend({container:c,backend:"MediaElement",mediaControls:!0},c.dataset);c.style.display="block";d=WaveSurfer.create(d);if(c.dataset.peaks)var e=JSON.parse(c.dataset.peaks);d.load(c.dataset.url,e)})};document.readyState==="complete"?a():window.addEventListener("load",a)})();
